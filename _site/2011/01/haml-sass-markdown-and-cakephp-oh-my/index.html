<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<title>Haml, Sass, Markdown, and CakePHP - Oh My! | Travis Berry</title>
		<meta name="author" content="Travis Berry">
		<!-- Mobile viewport optimized: j.mp/bplateviewport -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="shortcut icon" type="image/x-icon" href="http://www.travisberry.com/favicon.ico">
		<link href="http://static-assets1.travisberry.com/apple-touch/57.png" rel="apple-touch-icon" sizes="57x57" type="image/png" />
		<link href="http://static-assets1.travisberry.com/apple-touch/72.png" rel="apple-touch-icon" sizes="72x72" type="image/png" />
		<link href="http://static-assets1.travisberry.com/apple-touch/114.png" rel="apple-touch-icon" sizes="114x114" type="image/png" />
		
		<link rel="alternate" type="application/atom+xml" href="http://www.travisberry.com/atom.xml" />
		<link href="http://static-assets.travisberry.com/assets/application.css.gz" media="screen" rel="stylesheet" type="text/css" />
		<link rel="canonical" href="http://www.travisberry.com/2011/01/haml-sass-markdown-and-cakephp-oh-my/" />
		<!--[if lt IE 9]>
			<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
		<![endif]-->
		<!--[if lte IE 7]>
			<link href="http://static.travisberry.com/sites/4ddebc054a2ab10001000007/theme/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" />
			<script type="text/javascript" src="http://static-assets.travisberry.com/js/unitpngfix.js"></script>
		<![endif]-->
		
			<meta content="I've recently begun using Haml and Sass instead of good ol' HTML and CSS. " name="description" />
		
	</head>
	<body>
		<div id="topBar">
			
				<a href="http://www.travisberry.com/2013/02/help-a-scientist"><img src="http://static-assets3.travisberry.com/thumbnails/mad_scientist_thumb.jpg" alt="Help A Scientist" title="Help A Scientist" width=20 height=20 /></a>
			
				<a href="http://www.travisberry.com/2013/02/simple-multi-file-uploads-with-paperclip"><img src="http://static-assets3.travisberry.com/thumbnails/paperclip_thumb.jpg" alt="Simple Multi-File Uploads With Paperclip" title="Simple Multi-File Uploads With Paperclip" width=20 height=20 /></a>
			
				<a href="http://www.travisberry.com/2012/04/moving-from-indextank-to-indexden"><img src="http://static-assets.travisberry.com/thumbnails/indexden_thumb.jpg" alt="Moving From IndexTank To IndexDen" title="Moving From IndexTank To IndexDen" width=20 height=20 /></a>
			
				<a href="http://www.travisberry.com/2012/04/real-time-in-place-editing-for-rails"><img src="http://static-assets3.travisberry.com/thumbnails/juggernaut_thumb.jpg" alt="Real-Time In Place Editing For Rails" title="Real-Time In Place Editing For Rails" width=20 height=20 /></a>
			
				<a href="http://www.travisberry.com/2012/02/hubot-deploy"><img src="http://static-assets3.travisberry.com/thumbnails/hubot-capistrano_thumb.jpg" alt="Hubot Deploy" title="Hubot Deploy" width=20 height=20 /></a>
			
				<a href="http://www.travisberry.com/2011/12/so-long-and-thanks-for-the-elephant"><img src="http://static-assets2.travisberry.com/thumbnails/elephant_thumb.jpg" alt="So Long And Thanks For The Elephant" title="So Long And Thanks For The Elephant" width=20 height=20 /></a>
			
			<noscript style="font-size:12px;vertical-align:middle;">
				For full functionality of this site it is necessary to enable JavaScript.
				Here are the <a href="http://www.enable-javascript.com/" target="_blank">
				instructions how to enable JavaScript in your web browser</a>.
				<style>
					pre{
					  text-shadow: none !important;
					  font-size:14px;
					  background-color: #111111;
					  color: #CAF715;
						padding:10px;
						margin-bottom:20px;
						overflow:auto;
					}
				</style>
			</noscript>
		</div>
		<div id="wrapper" class="container_12">
			<div id="content">
				<nav>
					<ul id="menu" class="clearfix">
						<li class="link on first last" id="home-link"><a href="/"><span></span>Home</a></li>
						<li class="link on first last" id="blog-link"><a href="/blog/"><span></span>Blog</a></li>
						<li class="link on first last" id="work-link"><a href="/work/"><span></span>Work</a></li>
						<li class="link on first last" id="contact-link"><a href="/contact/"><span></span>Contact</a></li>
					</ul>
					<br class="clear" />
				</nav>
				<div id="post">
<p><article class="post clearfix">
  <h3>Haml, Sass, Markdown, and CakePHP - Oh My!</h3>
  <a href="http://oldstatic.travisberry.com/wp-content/uploads/2011/01/haml-sass.jpg" class="postImageLink"><img src="http://oldstatic3.travisberry.com/wp-content/uploads/2011/01/haml-sass.jpg" alt="" class="thumbnail alignleft" width=640  /></a>
  <h6>Published: January 11, 2011</h6></p>

<p>I've recently begun using <a href="http://haml-lang.com/">Haml</a> and <a href="http://sass-lang.com/">Sass</a> instead of good ol' HTML and CSS. If you haven't heard of them, "Haml is a refreshing take that is meant to free us from the shitty templating languages we have gotten used to", and "Sass makes CSS fun again". The conciseness and power of Haml and Sass are what really made me make the switch. There was just one downside, both are designed for use with Ruby.</p>

<p>While I don't have anything against Ruby, it's not my language of choice. I use PHP for just about everything backend and most of my apps and sites are built upon CakePHP, my favorite framework.</p>

<p>Luckily there are ports of Haml and Sass for use with PHP. There are several out there, but I went with PHamlP mainly because it has a CakePHP plugin available for download.</p>

<p>The install instructions for the plugin are greatly lacking, or at least I couldn't get them to work out of the box, so I decided to document how I went about getting it working and rocking out.</p>

<p>Oh, and as a bonus, we are going to setup <a href="http://daringfireball.net/projects/markdown/">Markdown</a> too.</p>

<p>So to start <a href="http://code.google.com/p/phamlp/downloads/list">grab a copy of PHamlP</a> and find a CakePHP project you would like to add it to. Unzip the file and you should be looking at a Installation.txt, license.txt, vendors, views, and webroot folders.</p>

<p>Copy the files in each folder to their corresponding folders in /app in your Cake project. (e.g. vendors => vendors | views => views | webroot => webroot)</p>

<p>Now for all the wonderful configuring.</p>

<p><strong>HAML</strong></p>

<p>Let's start with getting just Haml working for the time being.</p>

<p>Open up your app_controller.php and add the following line</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177229.js?file=example1.php'></script><noscript><pre><code>var $view = &#39;Haml&#39;;</code></pre></noscript>
</div>


<p>Now open up /config/core.php and scroll to the bottom. Add</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177229.js?file=example2.php'></script><noscript><pre><code>Configure::write(&#39;Haml.format&#39;, &#39;html5&#39;);
Configure::write(&#39;Haml.filterDir&#39;, VIEWS.&#39;filters&#39;);</code></pre></noscript>
</div>


<p>The first option is telling Haml which HTML or XHTML version to compile into. I use HTML5 for everything these days so that's what I picked. The second option tells the app where to find the Haml filter that starts the process of compiling Haml to HTML. If you put the filters folder inside your views folder, this is the path you need.</p>

<p>Now open up the haml.php file you added to views. Find the line that says</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177229.js?file=example3.php'></script><noscript><pre><code>App::import(&#39;Vendor&#39;, &#39;HamlParser&#39;, array(&#39;file&#39;=&gt;&#39;phamlp&#39;.DS.&#39;haml&#39;.DS.&#39;HamlParser.php&#39;));</code></pre></noscript>
</div>


<p>and change it to</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177229.js?file=example4.php'></script><noscript><pre><code>App::import(&#39;Vendor&#39;, &#39;HamlParser&#39;, array(&#39;file&#39;=&gt;&#39;haml&#39;.DS.&#39;HamlParser.php&#39;));</code></pre></noscript>
</div>


<p>This assumes you copied the vendors contents to vendors in CakePHP.</p>

<p>After that, you should have Haml up and running. I find the best way to test without changing all you layouts and views is to test with a page, then move on to replacing the rest of your views.</p>

<p><strong>SASS</strong></p>

<p>Let's tackle the Sass.</p>

<p>One important decision to make right off the bat is if you want to use the older .sass format or the newer .scss version. Now according to the docs, it shouldn't matter, you just create whatever type you want and it handles the rest. Well I didn't find this to work, and I had to change some code to support .scss files. So for the purpose of this tutorial I will show how to get those to work, but I'll flag the step to skip if you want to use the older .sass</p>

<p>With that out of the way, time to start the config.</p>

<p>Open the core.php file back up and go to the Haml code we added earlier. Under that add</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177229.js?file=example5.php'></script><noscript><pre><code>Configure::write(&#39;Sass.style&#39;, &#39;compressed&#39;);
Configure::write(&#39;Asset.filter.css&#39;, &#39;sass.php&#39;);</code></pre></noscript>
</div>


<p>The first line sets the output style of the css. I use compressed as it saves a little filesize, you can pick whatever you would like though. The second line tells Cake to filter the files with the sass.php you put in webroot.</p>

<p>Now open up sass.php and find the line that looks like</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177229.js?file=example6.php'></script><noscript><pre><code>App::import(&#39;Vendor&#39;, &#39;SassParser&#39;, array(&#39;file&#39;=&gt;&#39;phamlp&#39;.DS.&#39;sass&#39;.DS.&#39;SassParser.php&#39;));</code></pre></noscript>
</div>


<p>Replace it with</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177229.js?file=example7.php'></script><noscript><pre><code>App::import(&#39;Vendor&#39;, &#39;SassParser&#39;, array(&#39;file&#39;=&gt;&#39;sass&#39;.DS.&#39;SassParser.php&#39;));</code></pre></noscript>
</div>


<p>After that you should be able to start putting .sass files into your css directory and they will compile to css.</p>

<p>However, at least in my case, I lost my gzip on the css files. To add it back, replace the section that sets the headers, looks like</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177229.js?file=example8.php'></script><noscript><pre><code>header(&quot;Content-Type: text/css&quot;);
header(&quot;Expires: &quot; . gmdate(&quot;D, j M Y H:i:s&quot;, time() + DAY) . &quot; GMT&quot;);
header(&quot;Cache-Control: cache&quot;); // HTTP/1.1
header(&quot;Pragma: cache&quot;);        // HTTP/1.0</code></pre></noscript>
</div>


<p>with</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177229.js?file=example9.php'></script><noscript><pre><code>ob_start (&quot;ob_gzhandler&quot;);
header(&quot;Content-Type: text/css&quot;);
$seconds_to_cache = 31556926;
$ts = gmdate(&quot;D, d M Y H:i:s&quot;, time() + $seconds_to_cache) . &quot; GMT&quot;;
header(&quot;Expires: $ts&quot;);
header(&quot;Pragma: cache&quot;);
header(&quot;Cache-Control: maxage=$seconds_to_cache&quot;);</code></pre></noscript>
</div>


<p>Then add a line to the bottom of the file with this</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177233.js?file=example10.php'></script><noscript><pre><code>ob_end_flush();</code></pre></noscript>
</div>


<p>Your compiled css files should now transfer gzipped.</p>

<p>Now lets add support for the newer .scss file. If you want to use .sass you can skip this part.</p>

<p>Find the line</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177233.js?file=example11.php'></script><noscript><pre><code>$sassFile = str_replace(&#39;.css&#39;, &#39;.sass&#39;, $cssFile);</code></pre></noscript>
</div>


<p>and replace it with</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177233.js?file=example12.php'></script><noscript><pre><code>$sassFile = str_replace(&#39;.css&#39;, &#39;.scss&#39;, $cssFile);</code></pre></noscript>
</div>


<p>You can now use .scss files instead of .sass</p>

<p>Haml and Sass should be up and running now.</p>

<p><strong>MARKDOWN</strong></p>

<p>However, some people make the argument that you shouldn't use Haml to style the content of your page. By content, they are referring to the main text of the page. The "meat" so to speak. For a good read on the subject, check out this post. http://chriseppstein.github.com/blog/2010/02/08/haml-sucks-for-content/</p>

<p>Well one great alternative to using HTML to markup you text, is to use Markdown. To use Markdown with Haml you use something similar to</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177233.js?file=example13.php'></script><noscript><pre><code>:markdown
    Here is some markdown
    ===</code></pre></noscript>
</div>


<p>inside your Haml files. To get support for this, you need to download the latest Markdown PHP port from http://michelf.com/projects/php-markdown/</p>

<p>Make sure to grab the EXTRA's version.</p>

<p>Add a folder to vendors called markdown. Place the download files into it.</p>

<p>Now open up the HamlMarkdownFilter.php inside the views/filters folder.</p>

<p>Change</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177233.js?file=example14.php'></script><noscript><pre><code>App::import(&#39;Vendor&#39;, &#39;HamlMarkdownFilter&#39;, array(&#39;file&#39;=&gt;&#39;phamlp&#39;.DS.&#39;haml&#39;.DS.&#39;filters&#39;.DS.&#39;_HamlMarkdownFilter.php&#39;));</code></pre></noscript>
</div>


<p>To</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177233.js?file=example15.php'></script><noscript><pre><code>App::import(&#39;Vendor&#39;, &#39;HamlMarkdownFilter&#39;, array(&#39;file&#39;=&gt;&#39;haml&#39;.DS.&#39;filters&#39;.DS.&#39;_HamlMarkdownFilter.php&#39;));</code></pre></noscript>
</div>


<p>Now open up the _HamlMarkdownFilter.php file inside /vendors/haml/filters</p>

<p>Change</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177233.js?file=example16.php'></script><noscript><pre><code>protected $vendorClass = &#39;MarkdownExtra_Parser&#39;;</code></pre></noscript>
</div>


<p>To</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177233.js?file=example17.php'></script><noscript><pre><code>protected $vendorClass = &#39;Markdown_Parser&#39;;</code></pre></noscript>
</div>


<p>also change</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177233.js?file=example18.php'></script><noscript><pre><code>return &#39;&lt;?php   &#39;.(!empty($this-&gt;vendorPath)?&#39;require_once &quot;&#39;.$this-&gt;vendorPath.&#39;&quot;;&#39;:&#39;&#39;).&#39;$markdown___=new &#39;.$this-&gt;vendorClass.&#39;();echo  $markdown___-&gt;safeTransform(&quot;&#39;.preg_replace(HamlParser::MATCH_INTERPOLATION, &#39;&quot;.\1.&quot;&#39;, $text).&#39;&quot;);?&gt;&#39;;</code></pre></noscript>
</div>


<p>To</p>

<div class="gistFallback">
<script src='https://gist.github.com/1177233.js?file=example19.php'></script><noscript><pre><code>return &#39;&lt;?php   &#39;.(!empty($this-&gt;vendorPath)?&#39;require_once &quot;&#39;.$this-&gt;vendorPath.&#39;&quot;;&#39;:&#39;&#39;).&#39;$markdown___=new &#39;.$this-&gt;vendorClass.&#39;();echo  $markdown___-&gt;transform(&quot;&#39;.preg_replace(HamlParser::MATCH_INTERPOLATION, &#39;&quot;.\1.&quot;&#39;, $text).&#39;&quot;);?&gt;&#39;;</code></pre></noscript>
</div>


<p>Now throw some Markdown into you Haml files and prepare to be amazed.</p>

<p>I'm not sure why I had to change so much to get this setup to work. If you compare the Installation.txt to this post, you will see mine takes much more work. Don't take that as a dig on the developers though, there could be many reasons their instructions didn't work for me. I just figured if I had this hard of a time, someone else may run into similar issues and I could save them some time with this write up.</p>

<p>If I am an idiot and there is a way simpler way to get this working, let me know in the comments. You can also view a project I've set this up with on <a href="https://github.com/ninetwentyfour/Homkora">github</a>.
</article></p>

</div>
<p><a href="http://news.ycombinator.com/submit" class="hn-share-button">Vote on HN</a></p>
<div id="related">
  <h2>Probably Not Related Posts</h2>
  <ul class="posts">
    
      <li><span>09 Feb 2013</span> &raquo; <a href="/2013/02/help-a-scientist">Help A Scientist</a></li>
    
      <li><span>01 Feb 2013</span> &raquo; <a href="/2013/02/simple-multi-file-uploads-with-paperclip">Simple Multi-File Uploads With Paperclip</a></li>
    
      <li><span>08 Apr 2012</span> &raquo; <a href="/2012/04/moving-from-indextank-to-indexden">Moving From IndexTank To IndexDen</a></li>
    
  </ul>
</div>
			</div> <!-- end content -->
			<div class="clear"></div>
			<footer id="footer" class="grid_12">
				<h1><a href="/">Travis Berry</a></h1>
			</footer> <!-- end footer -->
			<div class="clear"></div>
		</div> <!-- end wrapper -->
		<a href="#top" id="top-link">&and;</a>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
		<script src="http://static-assets.travisberry.com/assets/application.js.gz"></script>
		<script>
			(function() {
				var hn = document.createElement('script'); hn.type = 'text/javascript';
				hn.async = true; hn.src = 'http://hnbutton.appspot.com/static/hn.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(hn, s);
			})();
		</script>
		<script type="text/javascript">
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-11593601-1']);
		  _gaq.push(['_trackPageview']);
		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
		</script>
	</body>
</html>