<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Use PHP To Zip Folders For Download | Travis Berry</title>
    <meta name="author" content="Travis Berry">
    <!-- Mobile viewport optimized: j.mp/bplateviewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="http://travisberry.heroku.com/feed.rss" rel="alternate" title="RSS" type="application/rss+xml" />
    
    <link href="http://static.travisberry.com/sites/4ddebc054a2ab10001000007/theme/stylesheets/stylev2.css" media="screen" rel="stylesheet" type="text/css" />
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
    <!--[if lte IE 7]>
    ie
    <![endif]-->
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
    </head>
      <body>
        <div id="topBar">
          
          <a href="http://localhost:4000/2011/05/create-github-gist-with-ruby.html"><img src="http://www.travisberry.com/wp-content/uploads/2011/05/gists.jpg" alt="Create GitHub Gist With Ruby" title="Create GitHub Gist With Ruby" width=20 height=20 /></a>
          
          <a href="http://localhost:4000/2011/05/write-text-anywhere-with-html5-canvas.html"><img src="http://www.travisberry.com/wp-content/uploads/2011/05/canvas.jpg" alt="Write Text Anywhere With HTML5 Canvas" title="Write Text Anywhere With HTML5 Canvas" width=20 height=20 /></a>
          
          <a href="http://localhost:4000/2011/03/a-day-in-the-life-of-me.html"><img src="http://static.travisberry.com/sites/4ddebc054a2ab10001000007/assets/4de4286bd48c1200010000c7/selfhomecrop2.jpg" alt="A Day In The Life Of Me" title="A Day In The Life Of Me" width=20 height=20 /></a>
          
          <a href="http://localhost:4000/2011/02/fast-cakephp-search-with-indextank.html"><img src="http://www.travisberry.com/wp-content/uploads/2011/02/indextank.jpg" alt="Fast CakePHP Search With IndexTank" title="Fast CakePHP Search With IndexTank" width=20 height=20 /></a>
          
          <a href="http://localhost:4000/2011/01/haml-sass-markdown-and-cakephp-oh-my.html"><img src="http://www.travisberry.com/wp-content/uploads/2011/01/haml-sass.jpg" alt="Haml, Sass, Markdown, and CakePHP - Oh My!" title="Haml, Sass, Markdown, and CakePHP - Oh My!" width=20 height=20 /></a>
          
          <a href="http://localhost:4000/2011/01/new-time-tracking-web-app-homkora.html"><img src="http://www.travisberry.com/wp-content/uploads/2011/01/homkora-cap.jpg" alt="New Time Tracking Web App - Homkora" title="New Time Tracking Web App - Homkora" width=20 height=20 /></a>
          
        </div>
        <div id="wrapper" class="container_12">
          <!--<header id="header" class="grid_12">
          <h1><a href="/">Travis Berry</a></h1>
        </header>--> <!-- end header -->
				<div id="content">     
				  <nav>
					  <ul id="menu" class="clearfix">
					    <li class="link on first last" id="home-link"><a href="/"><span></span>Home</a></li>
							<li class="link on first last" id="home-link"><a href="/blog.html"><span></span>Blog</a></li>
							<li class="link on first last" id="home-link"><a href="/work.html"><span></span>Work</a></li>
							<li class="link on first last" id="home-link"><a href="/contact.html"><span></span>Contact</a></li>
					  </ul>
					  <br class="clear" />
					</nav>
				  <!-- Show a "Please Upgrade" box to both IE7 and IE6 users (Edit to IE 6 if you just want to show it to IE6 users) - jQuery will load the content from js/ie.html into the div -->
				  <!--[if lte IE 7]>
				  <div class="ie grid_7"></div>
				  <![endif]-->
					<div id="post">
<p><a href="http://www.flickr.com/photos/striatic/443918201/"><img src="http://content.travisberry.com/zip_files.jpg" title="zip_files" alt="" /></a>Uploading files with PHP is covered to death on the internet. The other side of that, downloading files, is not covered nearly as much. When a user uploads say, hundreds of images to a folder, and they want to download them all later, it can turn into a giant time sink making them download the files one at a time.A better alternative would be to offer the files individually and with a "Download All As Zip" link.<!--more-->I found a solution <a href="http://www.trash.net/~ck/ontheflyzip/">here</a>, but it required putting the php file in every directory you would like to zip. Not exactly the best solution. So I tweaked it to be a bit more dynamic.This code is based on the assumption that there is a folder called something like <em>user_uploads</em> with a sub-folder for each user, something like <em>Travis_Berry</em><code>&lt;?php //Get the directory to zip    $filename_no_ext= $_GET['directtozip'];    // we deliver a zip file    header("Content-Type: archive/zip");    // filename for the browser to save the zip file    header("Content-Disposition: attachment; filename=$filename_no_ext".".zip");    // get a tmp name for the .zip    $tmp_zip = tempnam ("tmp", "tempname") . ".zip";    //change directory so the zip file doesnt have a tree structure in it.    chdir('user_uploads/'.$_GET['directtozip']);        // zip the stuff (dir and all in there) into the tmp_zip file    exec('zip '.$tmp_zip.' *');        // calc the length of the zip. it is needed for the progress bar of the browser    $filesize = filesize($tmp_zip);    header("Content-Length: $filesize");    // deliver the zip file    $fp = fopen("$tmp_zip","r");    echo fpassthru($fp);    // clean up the tmp zip file    unlink($tmp_zip);?&gt;</code>Save this code as zip_folders.phpThen when you want to provide a link to download a users uploads as a zip file, you link to it like,<code>[Download All As Zip](zip_folders.php?directtozip=THE USERS DIRECTORY)</code>That will cause a download prompt to appear for the user when clicking on the link.You'll notice I use the <a href="http://linux.about.com/od/commands/l/blcmdl1_zip.htm">system Zip command</a> as opposed to the <a href="http://www.php.net/manual/en/book.zip.php">PHP Zip extension</a>. For more complex Zipping needs, it looks like it would be a better alternative. For something simple like this, I find the system call sufficient.If you find this post useful, or have any PHP Zip tips, let me know in the comments.<script>utmx_section("contact1")</script><div id="contactme"><div class="avatar"><img src="http://www.gravatar.com/avatar/c9e8248c1237949b66a735bed64ae841?s=32&amp;d=identicon&amp;r=G" alt="" /></div>I'm just a guy interested in all things design and web related. You should <a href="http://www.travisberry.com/contact/">contact me</a> about about this article, for freelance work, or for any reason.</div></p>

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>30 May 2011</span> &raquo; <a href="/2011/05/create-github-gist-with-ruby.html">Create GitHub Gist With Ruby</a></li>
    
      <li><span>26 May 2011</span> &raquo; <a href="/2011/05/write-text-anywhere-with-html5-canvas.html">Write Text Anywhere With HTML5 Canvas</a></li>
    
      <li><span>04 Mar 2011</span> &raquo; <a href="/2011/03/a-day-in-the-life-of-me.html">A Day In The Life Of Me</a></li>
    
  </ul>
</div>
				</div> <!-- end content -->
				<div class="clear"></div>
				<footer id="footer" class="grid_12">
				  <h1><a href="/">Travis Berry</a></h1>
				</footer> <!-- end footer -->
				<div class="clear"></div>
				</div> <!-- end wrapper -->
				</body>
				</html>